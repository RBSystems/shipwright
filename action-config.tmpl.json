[
  {
    "name": "open cabinet email",
    "trigger": "alert-change",
    "if": {
      "alert-match": {
        "type": "open-cabinet"
      }
    },
    "then": [
      {
        "do": "send-email",
        "with": {
          "from": "{{.Alert.DeviceID}}@byu.edu",
          "to": ["matt_blodgett@byu.edu", "danny_randall@byu.edu"],
          "subject": "Open Cabinet Alert in {{.Alert.RoomID}}",
          "body": "There was an open cabinet alert sent at {{.Alert.AlertStartTime}} from {{.Alert.AlertID}}.\n\n {{.Alert | printf `%+v`}}",
          "smtp-addr": "gateway.byu.edu:25"
        }
      }
    ]
  },
  {
    "name": "open cabinet",
    "trigger": "event",
    "if": {
      "event-match": {
        "key": "user-interaction",
        "value": "open help modal"
      }
    },
    "then": [
      {
        "do": "add-alert",
        "with": {
          "buildingID": "MATT",
          "roomID": "{{.Event.AffectedRoom.RoomID}}",
          "deviceID": "TEST",
          "type": "open-cabinet",
          "category": "security",
          "severity": "critical",
          "message": "Open cabinet alert in {{.Event.AffectedRoom.BuildingID}}",
          "data": "{{.Event | printf `%+v`}}",
          "start-time": "{{.Event.Timestamp.Format `2006-01-02T15:04:05Z07:00`}}",
          "system-type": "DMPS",
          "alert-tags": [],
          "room-tags": [],
          "device-tags": []
        }
      }
    ]
  }
]
