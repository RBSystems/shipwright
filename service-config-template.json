{
    "caches": [{
        "name": "Default",
        "storage-type": "elk",
        "cache-type": "default",
        "elk-cache": {
            "device-index": "oit-static-av-devices-v2",
            "url": "$ELK_DIRECT_ADDR"
        }
    }],
    "forwarders": [{
            "name": "ElkDeltaEvents",
            "type": "elktimseries",
            "event-type": "delta",
            "interval": 15,
            "data-type": "device",
            "cache-type": "default",
            "elk": {
                "url": "$ELK_DIRECT_ADDR",
                "index-pattern": "av-delta-events",
                "index-rotation-interval": "monthly"
            }
        },
        {
            "name": "ElkAllEvents",
            "type": "elktimseries",
            "event-type": "all",
            "interval": 15,
            "data-type": "device",
            "cache-type": "default",
            "elk": {
                "url": "$ELK_DIRECT_ADDR",
                "index-pattern": "av-all-events",
                "index-rotation-interval": "daily"
            }
        },
        {
            "name": "ElkStaticDevicesHistory",
            "type": "elkstatic",
            "event-type": "delta",
            "interval": 15,
            "data-type": "device",
            "cache-type": "default",
            "elk": {
                "url": "$ELK_DIRECT_ADDR",
                "index-pattern": "oit-static-av-devices-history",
                "index-rotation-interval": "monthly"
            }
        },
        {
            "name": "CouchStaticDevicesHistory",
            "type": "couch",
            "event-type": "delta",
            "interval": 15,
            "data-type": "device",
            "cache-type": "default",
            "couch": {
                "url": "$COUCH_ADDR",
                "database-name": "device-state"
            }
        },
        {
            "name": "MainStaticDeviceIndex",
            "type": "elkstatic",
            "event-type": "all",
            "interval": 15,
            "data-type": "device",
            "cache-type": "default",
            "elk": {
                "url": "$ELK_DIRECT_ADDR",
                "index-pattern": "oit-static-av-devices-v2",
                "index-rotation-interval": "norotate",
                "upsert": true
            }
        }
    ],
    "jobs": [{
            "name": "help-request-email",
            "triggers": [{
                "type": "match",
                "match": {
                    "Key": "help-request",
                    "EventTags": ["alert"],
                    "Value": "confirm"
                }
            }],
            "enabled": true,
            "action": {
                "action-type": "email",
                "fields": {
                    "recipients": "joe_blodgett@byu.edu,danny_randall@byu.edu",
                    "sender": "av-alerts@byu.edu",
                    "user": "",
                    "pass": "",
                    "subject": "Help Request",
                    "body": "There was a help request in room {{AffectedRoom.RoomID}} on device {{TargetDevice.DeviceID}}.",
                    "smtp-addr": "gateway.byu.edu:25"
                }
            }
        },
        {
            "name": "cabinet-open-alert",
            "enabled": true,
            "triggers": [{
                "type": "match",
                "match": {
                    "key": "secure",
                    "value": "True"
                }
            }]
        }
    ],
    "actions": [{
        "trigger": "event // or 5s, or disabled",
        "if": {
            "event-match": {
                "key": "secure",
                "value": "False"
            }
        },
        "then": [{
                "do": "add-alert",
                "with": {
                    "alert": "hi",
                    "type": "missing heartbeat",
                    "msg log": ["something went wrong with {{.DeviceID}}"],
                    "severity": "test"
                }
            },
            {
                "do": "send-email",
                "with": {
                    "recipients": "matt_blodgett@byu.edu, danny_randall@byu.edu",
                    "sender": "{{.DeviceID}}@byu.edu",
                    "user": "",
                    "pass": "",
                    "subject": "Cabinet Opened in {{.RoomID}} // TODO these fields use go's templating engine",
                    "body": "A cabinet was opened in {{.RoomID}} at {{.Timestamp}}.",
                    "smtp-addr": "gateway.byu.edu:25"
                }
            }
        ]
    }]
}