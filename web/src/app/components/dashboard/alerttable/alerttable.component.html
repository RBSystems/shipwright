<div class="mat-elevation-z3 container">
    <table mat-table [dataSource]="issueData" matSort multiTemplateDataRows class="mat-elevation-z0">
        <ng-container matColumnDef="icon">
            <th mat-header-cell *matHeaderCellDef> System Type </th>
            <td mat-cell *matCellDef="let issue" (click)="ExpandRow(issue)">
                <mat-icon>{{text.SystemTypeIcon[issue.systemType]}}</mat-icon>
            </td>
        </ng-container>

        <ng-container matColumnDef="roomID">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Room ID </th>
            <td mat-cell *matCellDef="let issue" (click)="ExpandRow(issue)">
                <div routerLink="/configuration/{{issue.roomID}}/roompage" class="fake-hyperlink">
                    {{issue.roomID}}
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="severity">
            <th mat-header-cell *matHeaderCellDef> Severity </th>
            <td mat-cell *matCellDef="let issue">
                <span [ngClass]="issue.severity + '-severity'">{{text.Title(issue.severity)}}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="count">
            <th mat-header-cell *matHeaderCellDef> Active/Total </th>
            <td mat-cell *matCellDef="let issue">{{issue.ActiveAlertCount()}}/{{issue.TotalAlertCount()}}</td>
        </ng-container>

        <ng-container matColumnDef="types">
            <th mat-header-cell *matHeaderCellDef> Alert Types </th>
            <td mat-cell *matCellDef="let issue" (click)="ExpandRow(issue)">{{issue.alertTypes.length > charCount ? (issue.alertTypes.toString() | slice:0:charCount)+".." : issue.alertTypes.toString()}}</td>
        </ng-container>

        <ng-container matColumnDef="incident">
            <th mat-header-cell *matHeaderCellDef> Incident ID </th>
            <td mat-cell *matCellDef="let issue">
                <div (click)="ServiceNowRedirect(issue.incidentID)" class="fake-hyperlink">
                    {{issue.roomID}}
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="help-sent">
            <th mat-header-cell *matHeaderCellDef class="centered"> Help Sent </th>
            <td mat-cell *matCellDef="let issue" (click)="ExpandRow(issue)" class="centered">
                <mat-icon *ngIf="issue.SentIsZero()" class="bad-status">cancel</mat-icon>
                <mat-icon *ngIf="!issue.SentIsZero()" class="good-status">check_circle</mat-icon>
            </td>
        </ng-container>

        <ng-container matColumnDef="help-arrived">
            <th mat-header-cell *matHeaderCellDef class="centered"> Help Arrived </th>
            <td mat-cell *matCellDef="let issue" (click)="ExpandRow(issue)" class="centered">
                <mat-icon *ngIf="issue.ArrivedIsZero()" class="bad-status">cancel</mat-icon>
                <mat-icon *ngIf="!issue.ArrivedIsZero()" class="good-status">check_circle</mat-icon>
            </td>
        </ng-container>

        <ng-container matColumnDef="responders">
            <th mat-header-cell *matHeaderCellDef> Responders </th>
            <td mat-cell *matCellDef="let issue" (click)="ExpandRow(issue)">
                {{issue.responders.toString()}}
            </td>
        </ng-container>

        <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let issue" [attr.colspan]="issueColumns.length">
                <div class="alert-detail" [@detailExpand]="expIssue === issue ? 'expanded' : 'collapsed'">
                    <table mat-table [dataSource]="issue.alerts" class="mat-elevation-z0">
                        <ng-container *ngIf="singleRoom" matColumnDef="select">
                            <th mat-header-cell *matHeaderCellDef>
                                <mat-checkbox (change)="$event ? MasterToggle() : null" [checked]="selection.hasValue() && IsAllSelected()" [indeterminate]="selection.hasValue() && !IsAllSelected()"></mat-checkbox>
                            </th>
                            <td mat-cell *matCellDef="let alert">
                                <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(alert) : null" [checked]="selection.isSelected(alert)"></mat-checkbox>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef> Device Name </th>
                            <td mat-cell *matCellDef="let alert">{{GetDeviceName(alert.deviceID)}}</td>
                        </ng-container>

                        <ng-container matColumnDef="type">
                            <th mat-header-cell *matHeaderCellDef> Type </th>
                            <td mat-cell *matCellDef="let alert">{{text.Title(alert.type)}}</td>
                        </ng-container>

                        <ng-container matColumnDef="category">
                            <th mat-header-cell *matHeaderCellDef> Category </th>
                            <td mat-cell *matCellDef="let alert">{{text.Title(alert.category)}}</td>
                        </ng-container>

                        <ng-container matColumnDef="message">
                            <th mat-header-cell *matHeaderCellDef> Message </th>
                            <td mat-cell *matCellDef="let alert">{{alert.message}}</td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="alertColumns"></tr>
                        <tr mat-row *matRowDef="let alert; columns: alertColumns;" (click)="selection.toggle(alert)"></tr>
                    </table>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="issueColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let issue; columns: issueColumns;" [class.example-expanded-row]="expIssue === issue"></tr>
        <tr mat-row *matRowDef="let issue; columns: ['expandedDetail']" class="alert-detail-row"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 50, 100]" [pageSize]="25"></mat-paginator>
</div>