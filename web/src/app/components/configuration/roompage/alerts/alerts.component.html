<div class="base">
    <section class="row" *ngIf="roomIssue == null">
        <section *ngIf="!data.finished" class="info-header">
            <h3 class="mat-h3">Currently updating room information...</h3>
        </section>
    </section>

    <section class="container" *ngIf="data.finished">
        <section class="row" *ngIf="roomIssue != null">
            <mat-card class="full-width">
                <mat-card-header>
                    <mat-card-title>Room Issues</mat-card-title>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content class="row-table">
                    <app-alert-table [singleRoom]="true" [expIssue]="roomIssue"></app-alert-table>
                </mat-card-content>
            </mat-card>

            <aside class="column mat-elevation-z3" *ngIf="filteredDevices != null">
                <div class="searchbar devices mat-elevation-z0">
                    <mat-icon class="searchbar icon mat-elevation-z0">search</mat-icon>
                    <mat-form-field class="short">
                        <input matInput [(ngModel)]="deviceSearch" (ngModelChange)="SearchDevices()" />
                    </mat-form-field>
                </div>
                <mat-list class="list mat-elevation-z0">
                    <ng-container *ngFor="let device of filteredDevices">
                        <mat-list-item *ngIf="device != null">
                            <mat-icon mat-list-icon>{{ text.DefaultIcons[device.type.id] }}
                            </mat-icon>
                            <h5 mat-line class="mat-h5">{{ device.name }}</h5>
                        </mat-list-item>
                    </ng-container>
                </mat-list>
            </aside>
        </section>

        <section class="cardrow">
            <mat-card class="actioncard">
                <mat-card-header>
                    <mat-card-title>Action Info</mat-card-title>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content>
                    <section class="row action">
                        <!-- <aside class="column schedule">
              <h3 class="mat-h3">Schedule</h3>
              <div class="schedule-container mat-elevation-z2">
                <div *ngIf="classSchedule != null && classSchedule.length == 0">
                  <h3 class="mat-h3">Looking for room schedule...</h3>
                </div>
                <table
                  mat-table
                  [dataSource]="scheduleData"
                  *ngIf="classSchedule != null && classSchedule.length > 0"
                >
                  <ng-container matColumnDef="block">
                    <th mat-header-cell *matHeaderCellDef>Time</th>
                    <td mat-cell *matCellDef="let classBlock">
                      {{ to24Hour(classBlock.blockStart) }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="className">
                    <th mat-header-cell *matHeaderCellDef>Class</th>
                    <td mat-cell *matCellDef="let classBlock">
                      {{ classBlock.className }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="classTime">
                    <th mat-header-cell *matHeaderCellDef>Class Time</th>
                    <td mat-cell *matCellDef="let classBlock">
                      {{ classBlock.classTime }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="teacher">
                    <th mat-header-cell *matHeaderCellDef>Teacher</th>
                    <td mat-cell *matCellDef="let classBlock">
                      {{ classBlock.teacher.name }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="days">
                    <th mat-header-cell *matHeaderCellDef>Days</th>
                    <td mat-cell *matCellDef="let classBlock">
                      {{ classBlock.days }}
                    </td>
                  </ng-container>
                  <tr
                    mat-header-row
                    *matHeaderRowDef="scheduleColumns; sticky: true"
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="let classBlock; columns: scheduleColumns"
                  ></tr>
                </table>
              </div>
            </aside> -->
                        <aside class="column visits" *ngIf="roomIssue != null">
                            <h3 class="mat-h3">Visits</h3>
                        </aside>
                        <aside class="column notes" *ngIf="roomIssue != null">
                            <h3 class="mat-h3">Notes</h3>
                            <section class="notes-row">
                                <div class="notes-column">
                                    <mat-form-field class="notes" appearance="outline">
                                        <textarea matInput placeholder="Add New Note" [matAutosizeMinRows]="4" [matTextareaAutosize]="true" [(ngModel)]="tempNotes" (keyup)="$event.keyCode == 13 ? AddNote() : null"></textarea>
                                    </mat-form-field>
                                </div>

                                <div class="notes-column">
                                    <!-- <h4 class="mat-subheading-2">Notes Log</h4> -->
                                    <mat-list class="notes-log" *ngIf="roomIssue.notesLog?.length > 0">
                                        <mat-list-item id="notesLog" *ngFor="let note of roomIssue.notesLog">
                                            <mat-icon id="icon" mat-list-icon>label</mat-icon>
                                            <p mat-line>{{ ExtractNoteInfo(note, false) }}</p>
                                            <p mat-line class="timestamp">
                                                {{ ExtractNoteInfo(note, true) }}
                                            </p>
                                        </mat-list-item>
                                    </mat-list>
                                </div>
                            </section>
                        </aside>
                    </section>
                </mat-card-content>
                <mat-divider></mat-divider>
                <mat-card-actions>
                    <button mat-raised-button color="primary" (click)="openRespond()">
            New Visit <mat-icon>add</mat-icon>
          </button>
                    <button mat-raised-button color="warn" (click)="modal.OpenMaintenanceModal(roomID)">
            Maintenance <mat-icon>bug_report</mat-icon>
          </button>
                    <button mat-raised-button class="button resolve" *ngIf="isResolvable()" (click)="openResolve()">
            Resolve Alerts
          </button>
                </mat-card-actions>
            </mat-card>
            <aside class="issue-free mat-elevation-z3" *ngIf="roomIssue == null">
                <div class="searchbar devices mat-elevation-z0" *ngIf="filteredDevices != null">
                    <mat-icon class="searchbar icon mat-elevation-z0">search</mat-icon>
                    <mat-form-field class="short">
                        <input matInput [(ngModel)]="deviceSearch" (ngModelChange)="SearchDevices()" />
                    </mat-form-field>
                </div>
                <mat-list class="list mat-elevation-z0">
                    <ng-container *ngFor="let device of filteredDevices">
                        <mat-list-item *ngIf="device != null">
                            <mat-icon mat-list-icon>{{ text.DefaultIcons[device.type.id] }}
                            </mat-icon>
                            <h5 mat-line class="mat-h5">{{ device.name }}</h5>
                        </mat-list-item>
                    </ng-container>
                </mat-list>
            </aside>
        </section>
        <!-- <section class="cardrow"> -->
        <!-- Notes Card -->

        <!-- </section> -->
    </section>
=======
                <mat-card-content class="issue-table">
                    <app-alert-table [singleRoom]="true" [expIssue]="roomIssue"></app-alert-table>
                </mat-card-content>
            </mat-card>
        </section>

        <section class="row action">
            <mat-card #actions class="action-card">
                <mat-card-header>
                    <mat-card-title>
                        Actions
                    </mat-card-title>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content class="action-content">
                    <section class="row big">
                        <button class="big-boy" mat-raised-button (click)="RedirectToPi(':10000/dashboard')" color="primary">Z-Pattern</button>
                        <button class="big-boy" mat-raised-button (click)="RedirectToPi(':8888')" color="primary">Control UI</button>
                    </section>
                    <!-- <section class="row action">
                        

                    </section> -->
                </mat-card-content>
                <mat-divider></mat-divider>
                <mat-card-actions>
                    <button mat-raised-button class="maintenance" (click)="modal.OpenMaintenanceModal(roomID)">Maintenance <mat-icon>build</mat-icon></button>
                    <button mat-raised-button class="resolver" *ngIf="isResolvable()" (click)="openResolve()">Resolve Alerts <mat-icon>done</mat-icon></button>
                </mat-card-actions>
            </mat-card>

            <mat-card #visits class="action-card">
                <mat-card-header>
                    <mat-card-title>
                        Visits
                    </mat-card-title>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content class="action-content">
                    <ng-container *ngIf="roomIssue != null">
                        <ng-container *ngIf="roomIssue?.roomIssueResponses == null || roomIssue?.roomIssueResponses.length == 0">
                            <span>No one has been sent to address this issue.</span>
                        </ng-container>
                        <section *ngIf="roomIssue?.roomIssueResponses != null && roomIssue?.roomIssueResponses.length > 0">
                            <table class="visits" mat-table [dataSource]="roomIssue?.roomIssueResponses">
                                <ng-container matColumnDef="sent">
                                    <th mat-header-cell *matHeaderCellDef>Sent At</th>
                                    <td mat-cell *matCellDef="let response">
                                        <span *ngIf="response.helpSentAt != null && !response.SentIsZero()">{{response.helpSentAt.toLocaleTimeString()}}</span>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="arrived">
                                    <th mat-header-cell *matHeaderCellDef>Arrived At</th>
                                    <td mat-cell *matCellDef="let response">
                                        <span *ngIf="response.helpArrivedAt != null && !response.ArrivedIsZero()">{{response.helpArrivedAt.toLocaleTimeString()}}</span>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="responders">
                                    <th mat-header-cell *matHeaderCellDef>Responders</th>
                                    <td mat-cell *matCellDef="let response">
                                        <ng-container *ngIf="response.responders != null && response.responders.length > 0">
                                            <span *ngFor="let person of response.responders">{{person.name}}</span>
                                        </ng-container>
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="responseColumns; sticky: true"></tr>
                                <tr mat-row *matRowDef="let response; columns: responseColumns"></tr>
                            </table>
                        </section>
                    </ng-container>

                </mat-card-content>
                <mat-divider></mat-divider>
                <mat-card-actions>
                    <button *ngIf="!FinishResponse()" mat-raised-button color="primary" (click)="openRespond(false)">Send Help <mat-icon>add</mat-icon></button>
                    <button *ngIf="FinishResponse()" mat-raised-button color="primary" (click)="openRespond(true)">Help Arrived <mat-icon>add</mat-icon></button>
                </mat-card-actions>
            </mat-card>

            <mat-card #notes class="action-card">
                <mat-card-header>
                    <mat-card-title>
                        Notes
                    </mat-card-title>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content class="action-content">
                    <section class="notes-row" *ngIf="roomIssue != null">
                        <div class="notes-column">
                            <mat-form-field class="notes" appearance="outline">
                                <textarea matInput placeholder="Add New Note" [matAutosizeMinRows]="5" [matTextareaAutosize]="true" [(ngModel)]="tempNotes" (keyup)="$event.keyCode == 13 ? AddNote() : null"></textarea>
                            </mat-form-field>
                        </div>

                        <div class="notes-column">
                            <mat-list class="notes-log" *ngIf="roomIssue.notesLog?.length > 0">
                                <mat-list-item id="notesLog" *ngFor="let note of roomIssue.notesLog">
                                    <mat-icon id="icon" mat-list-icon>label</mat-icon>
                                    <p mat-line>{{ ExtractNoteInfo(note, false) }}</p>
                                    <p mat-line class="timestamp">
                                        {{ ExtractNoteInfo(note, true) }}
                                    </p>
                                </mat-list-item>
                            </mat-list>
                        </div>
                    </section>
                </mat-card-content>
                <!-- <mat-divider></mat-divider> -->
                <mat-card-actions></mat-card-actions>
            </mat-card>

            <!-- <mat-card #schedule class="action-card">
                <mat-card-header>
                    <mat-card-title>
                        Schedule
                    </mat-card-title>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content class="action-content"></mat-card-content>
                <mat-divider></mat-divider>
                <mat-card-actions></mat-card-actions>
            </mat-card> -->
        </section>
    </section>


>>>>>>> stage
</div>
