<div class="container">
  <span class="fill-remaining-space"></span>
  <section class="container left">
    <mat-card *ngFor="let preset of config?.presets" class="preset-card">
      <mat-card-header>
        <div
          mat-card-avatar
          [ngClass]="'uipath-' + GetPresetUIPath(preset.name, true)"
        ></div>
        <mat-card-title>{{ preset.name }}</mat-card-title>
        <mat-card-subtitle>
          <ng-container *ngFor="let panel of config?.panels">
            <ng-container *ngIf="panel.preset === preset.name">
              {{ panel.hostname.split("-")[2] }}
            </ng-container>
          </ng-container>
        </mat-card-subtitle>
        <span class="fill-remaining-space"></span>
        <button mat-icon-button (click)="PrepPresetModal(preset)">
          <mat-icon>more_horiz</mat-icon>
        </button>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="content">
        <div class="row lists">
          <div
            class="drop-container list"
            dnd-droppable
            [dropZones]="['display']"
            (onDropSuccess)="AddDisplayToPreset(preset, $event.dragData.name)"
          >
            <mat-list class="preset-list">
              <h3 mat-subheader>Displays</h3>
              <ng-container *ngFor="let out of config?.outputConfiguration">
                <mat-list-item *ngIf="preset?.displays?.includes(out.name)">
                  <!-- <mat-icon mat-list-icon>{{out.icon}}</mat-icon>
                                            <span mat-line>{{out.name}}</span> -->
                  <div
                    class="device-box mat-elevation-z2 spacing"
                    dnd-draggable
                    [dragEnabled]="true"
                    [dropZones]="['display']"
                    [dragData]="out"
                    (onDragSuccess)="RemoveDisplayFromPreset(preset, $event.dragData.name)"
                  >
                    <div class="row card">
                      <mat-icon>{{ out.icon }}</mat-icon>
                      <span>{{ out.name }}</span>
                    </div>
                  </div>
                </mat-list-item>
              </ng-container>
            </mat-list>
          </div>

          <div
            class="drop-container list"
            dnd-droppable
            [dropZones]="['input']"
            (onDropSuccess)="AddInputToPreset(preset, $event.dragData.name)"
          >
            <mat-list class="preset-list">
              <h3 mat-subheader>Inputs</h3>
              <ng-container *ngFor="let in of config?.inputConfiguration">
                <mat-list-item *ngIf="preset?.inputs?.includes(in.name)">
                  <!-- <mat-icon mat-list-icon>{{in.icon}}</mat-icon>
                                            <span mat-line>{{in.name}}</span> -->
                  <div
                    class="device-box mat-elevation-z2 spacing"
                    dnd-draggable
                    [dragEnabled]="true"
                    [dropZones]="['input']"
                    [dragData]="in"
                    (onDragSuccessCallback)="
                      RemoveInputFromPreset(preset, $event.dragData.name)
                    "
                  >
                    <div class="row card">
                      <mat-icon>{{ in.icon }}</mat-icon>
                      <span>{{
                        in.name === "ChromeCast"
                          ? "CC1"
                          : in.name === "AppleTV"
                          ? "ATV1"
                          : in.name
                      }}</span>
                    </div>
                  </div>
                </mat-list-item>
              </ng-container>
            </mat-list>
          </div>

          <div
            class="drop-container list"
            dnd-droppable
            [dropZones]="['audio']"
            (onDropSuccess)="AddAudioToPreset(preset, $event.dragData.name)"
          >
            <mat-list class="preset-list">
              <h3 mat-subheader>Audio Devices</h3>
              <ng-container *ngFor="let out of config?.outputConfiguration">
                <mat-list-item
                  *ngIf="preset?.independentAudioDevices?.includes(out.name)"
                >
                  <!-- <mat-icon mat-list-icon>{{out.icon}}</mat-icon>
                                            <span mat-line>{{out.name}}</span> -->
                  <div
                    class="device-box mat-elevation-z2 spacing"
                    dnd-draggable
                    [dragEnabled]="true"
                    [dropZones]="['audio']"
                    [dragData]="out"
                    (onDragSuccessCallback)="
                      RemoveAudioFromPreset(preset, $event.dragData.name)
                    "
                  >
                    <div class="row card">
                      <mat-icon>{{ out.icon }}</mat-icon>
                      <span>{{ out.name }}</span>
                    </div>
                  </div>
                </mat-list-item>
              </ng-container>
            </mat-list>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </section>
  <mat-divider [vertical]="true"></mat-divider>
  <aside class="container right">
    <div class="searchbar devices mat-elevation-z0">
      <mat-icon class="searchbar icon mat-elevation-z0">search</mat-icon>
      <mat-form-field class="short">
        <input
          matInput
          [(ngModel)]="deviceSearch"
          (ngModelChange)="SearchDevices()"
        />
      </mat-form-field>
    </div>
    <div class="column">
      <div class="row">
        <div
          *ngFor="let device of filteredDevices"
          class="device-box mat-elevation-z2 spacing"
          dnd-draggable
          [dragEnabled]="true"
          [dropZones]="GetValidDropZones(device)"
          [dragData]="device"
        >
          <div class="row card">
            <mat-icon>{{ text.DefaultIcons[device.type.id] }}</mat-icon>
            <span>{{
              device.name === "ChromeCast"
                ? "CC1"
                : device.name === "AppleTV"
                ? "ATV1"
                : device.name
            }}</span>
          </div>
        </div>
      </div>
    </div>
    <span class="fill-remaining-space"></span>
    <div class="menu" dir="rtl">
      <button mat-fab color="primary" [matMenuTriggerFor]="classes">
        <mat-icon>add</mat-icon>
      </button>

      <mat-menu #classes>
        <button mat-menu-item (click)="AddNewDevice('Pi3')">
          <mat-icon>{{ text.DefaultIcons["Pi3"] }}</mat-icon>
          <span>Pi</span>
        </button>
        <button mat-menu-item (click)="AddNewDevice('SonyXBR')">
          <mat-icon>{{ text.DefaultIcons["SonyXBR"] }}</mat-icon>
          <span>TV</span>
        </button>
        <button mat-menu-item [matMenuTriggerFor]="projectors">
          Projector
        </button>
        <button mat-menu-item [matMenuTriggerFor]="inputs">Inputs</button>
      </mat-menu>

      <mat-menu #projectors>
        <button
          mat-menu-item
          *ngFor="let type of projectorTypes"
          (click)="AddNewDevice(type.id)"
        >
          <mat-icon>{{ text.DefaultIcons[type.id] }}</mat-icon>
          <span>{{ type.displayName }}</span>
        </button>
      </mat-menu>

      <mat-menu #inputs>
        <button
          mat-menu-item
          *ngFor="let type of inputTypes"
          (click)="AddNewDevice(type.id)"
        >
          <mat-icon>{{ text.DefaultIcons[type.id] }}</mat-icon>
          <span>{{ type.displayName }}</span>
        </button>
      </mat-menu>
    </div>
    <!-- <div class="row buttons"> -->
    <button mat-raised-button class="button save">Save Changes</button>
    <button mat-raised-button class="button undo" color="accent">
      Undo Changes
    </button>
    <!-- </div> -->
  </aside>
</div>
